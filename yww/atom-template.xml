<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/"
      xmlns:media="http://search.yahoo.com/mrss/"
      xmlns:dc="http://purl.org/dc/elements/1.1/">
    <title>{{ config.title }}</title>
    {% if icon %}<icon>{{ icon }}</icon>{% endif %}
    {% if config.subtitle %}<subtitle>{{ config.subtitle }}</subtitle>{% endif %}
    {% if config.description %}<dc:description>{{ config.description }}</dc:description>{% endif %}
    
    <!-- Feed 链接信息 -->
    <link href="{{ feed_url | uriencode }}" rel="self" type="application/atom+xml"/>
    {% if config.feed.hub %}<link href="{{ config.feed.hub | uriencode }}" rel="hub"/>{% endif %}
    <link href="{{ url | uriencode }}" type="text/html"/>
    
    <!-- 更新时间和标识 -->
    <updated>{% if posts.first().updated %}{{ posts.first().updated.toISOString() }}{% else %}{{ posts.first().date.toISOString() }}{% endif %}</updated>
    <id>{{ url | uriencode }}</id>
    
    <!-- 作者信息增强 -->
    {% if config.author %}
    <author>
        <name>{{ config.author }}</name>
        {% if config.email %}<email>{{ config.email }}</email>{% endif %}
        {% if url %}<uri>{{ url }}</uri>{% endif %}
    </author>
    {% endif %}
    
    <!-- 生成器信息 -->
    <generator uri="https://hexo.io/" version="{{ hexo_version }}">Hexo Enhanced RSS</generator>
    
    <!-- Feed 元信息 -->
    <rights>Copyright © {{ posts.first().date.format('YYYY') }} {% if config.author %}{{ config.author }}{% else %}{{ config.title }}{% endif %}</rights>
    {% if config.language %}<dc:language>{{ config.language }}</dc:language>{% endif %}
    {% for post in posts.toArray() %}
    <entry>
        <!-- 基本信息 -->
        <title type="html"><![CDATA[{{ post.title }}]]></title>
        <link href="{{ post.permalink | uriencode }}" rel="alternate" type="text/html"/>
        <id>{{ post.permalink | uriencode }}</id>
        
        <!-- 时间信息 -->
        <published>{{ post.date.toISOString() }}</published>
        <updated>{% if post.updated %}{{ post.updated.toISOString() }}{% else %}{{ post.date.toISOString() }}{% endif %}</updated>
        
        <!-- 作者信息 -->
        <author>
            <name>{% if config.author %}{{ config.author }}{% else %}Anonymous{% endif %}</name>
            {% if config.email %}<email>{{ config.email }}</email>{% endif %}
        </author>
        
        <!-- 文章摘要 -->
        {% if post.description %}
        <summary type="html"><![CDATA[{{ post.description }}]]></summary>
        {% elif post.intro %}
        <summary type="html"><![CDATA[{{ post.intro }}]]></summary>
        {% elif post.excerpt %}
        <summary type="html"><![CDATA[{{ post.excerpt }}]]></summary>
        {% elif post.content %}
        {% set short_content = post.content.substring(0, config.feed.content_limit) %}
        {% if config.feed.content_limit_delim %}
        {% set delim_pos = short_content.lastIndexOf(config.feed.content_limit_delim) %}
        {% if delim_pos > -1 %}
        <summary type="html"><![CDATA[{{ short_content.substring(0, delim_pos) }}...]]></summary>
        {% else %}
        <summary type="html"><![CDATA[{{ short_content }}...]]></summary>
        {% endif %}
        {% else %}
        <summary type="html"><![CDATA[{{ short_content }}...]]></summary>
        {% endif %}
        {% endif %}
        
        <!-- 文章封面图 -->
        {% if post.cover %}
        <media:content url="{{ post.cover | formatUrl }}" type="image" medium="image">
            <media:title>{{ post.title }}</media:title>
            <media:description>{{ post.title }} - 封面图</media:description>
        </media:content>
        {% endif %}

        <!-- 永久链接 -->
        {% if post.abbrlink %}
        <dc:identifier>{{ post.abbrlink }}</dc:identifier>
        {% endif %}
        
    </entry>
    {% endfor %}
</feed>
