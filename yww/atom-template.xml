<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:content="http://purl.org/rss/1.0/modules/content/"
      xmlns:media="http://search.yahoo.com/mrss/"
      xmlns:dc="http://purl.org/dc/elements/1.1/"
      xmlns:taxo="http://purl.org/rss/1.0/modules/taxonomy/">

    <!-- Feed Metadata -->
    <title>{{ config.title }}</title>
    {% if icon %}<icon>{{ icon }}</icon>{% endif %}
    {% if config.subtitle %}<subtitle>{{ config.subtitle }}</subtitle>{% endif %}
    {% if config.description %}<dc:description>{{ config.description }}</dc:description>{% endif %}

    <!-- Feed Links -->
    <link href="{{ feed_url | uriencode }}" rel="self" type="application/atom+xml"/>
    {% if config.feed.hub %}<link href="{{ config.feed.hub | uriencode }}" rel="hub"/>{% endif %}
    <link href="{{ url | uriencode }}" rel="alternate" type="text/html"/>

    <!-- Feed Update Time and Identifier -->
    <updated>{% if posts.first().updated %}{{ posts.first().updated.toISOString() }}{% else %}{{ posts.first().date.toISOString() }}{% endif %}</updated>
    <id>{{ url | uriencode }}</id>

    <!-- Author Information -->
    {% if config.author %}
    <author>
        <name>{{ config.author }}</name>
        {% if config.email %}<email>{{ config.email }}</email>{% endif %}
        {% if url %}<uri>{{ url }}</uri>{% endif %}
    </author>
    {% endif %}

    <!-- Generator Information -->
    <generator uri="https://hexo.io/" version="{{ hexo_version }}">Hexo Enhanced RSS</generator>

    <!-- Feed Rights and Language -->
    <rights>Copyright © {{ posts.first().date.format('YYYY') }} {% if config.author %}{{ config.author }}{% else %}{{ config.title }}{% endif %}</rights>
    {% if config.language %}<dc:language>{{ config.language }}</dc:language>{% endif %}

    <!-- Individual Entries -->
    {% for post in posts.toArray() %}
    <entry>
        <!-- Entry Title -->
        <title type="html"><![CDATA[{{ post.title }}]]></title>

        <!-- Entry Links -->
        <link href="{{ post.permalink | uriencode }}" rel="alternate" type="text/html"/>
        <id>{{ post.permalink | uriencode }}</id>

        <!-- Entry Dates -->
        <published>{{ post.date.toISOString() }}</published>
        <updated>{% if post.updated %}{{ post.updated.toISOString() }}{% else %}{{ post.date.toISOString() }}{% endif %}</updated>

        <!-- Entry Author -->
        <author>
            <name>{% if config.author %}{{ config.author }}{% else %}Anonymous{% endif %}</name>
            {% if config.email %}<email>{{ config.email }}</email>{% endif %}
        </author>

        <!-- Entry Summary -->
        {% if post.description %}
        <summary type="html"><![CDATA[{{ post.description }}]]></summary>
        {% elif post.intro %}
        <summary type="html"><![CDATA[{{ post.intro }}]]></summary>
        {% elif post.excerpt %}
        <summary type="html"><![CDATA[{{ post.excerpt }}]]></summary>
        {% elif post.content %}
        {% set short_content = post.content.substring(0, config.feed.content_limit) %}
        {% if config.feed.content_limit_delim %}
        {% set delim_pos = short_content.lastIndexOf(config.feed.content_limit_delim) %}
        {% if delim_pos > -1 %}
        <summary type="html"><![CDATA[{{ short_content.substring(0, delim_pos) }}...]]></summary>
        {% else %}
        <summary type="html"><![CDATA[{{ short_content }}...]]></summary>
        {% endif %}
        {% else %}
        <summary type="html"><![CDATA[{{ short_content }}...]]></summary>
        {% endif %}
        {% endif %}

        <!-- Entry Content -->
        {% if config.feed.content %}
        <content type="html" xml:base="{{ post.permalink | uriencode }}"><![CDATA[{{ post.content }}]]></content>
        {% endif %}

        <!-- Entry Cover Image -->
        {% if post.cover %}
        <media:content url="{{ post.cover | formatUrl }}" type="image" medium="image">
            <media:title>{{ post.title }}</media:title>
            <media:description>{{ post.title }} - 封面图</media:description>
        </media:content>
        {% endif %}

        <!-- Entry Categories -->
        {% if post.categories %}
        {% for category in post.categories.toArray() %}
        <category term="{{ category.name }}" label="{{ category.name }}" />
        {% endfor %}
        {% endif %}

        <!-- Entry Tags -->
        {% if post.tags %}
        {% for tag in post.tags.toArray() %}
        <category term="{{ tag.name }}" label="{{ tag.name }}" />
        {% endfor %}
        {% endif %}

        <!-- Entry Permanent Link Identifier -->
        {% if post.abbrlink %}
        <dc:identifier>{{ post.abbrlink }}</dc:identifier>
        {% endif %}

    </entry>
    {% endfor %}
</feed>